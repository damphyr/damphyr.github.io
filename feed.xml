<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Ampelofilosofies</title>
    <description>Random comments on random subjects in random language</description>
    <link>http://www.ampelofilosofies.gr</link>
    <atom:link href="http://www.ampelofilosofies.gr/feed.xml" rel="self" type="application/rss+xml" />
    
      <item>
        <title>Windows 7 Update Hell</title>
        <description>&lt;h2&gt;Death by a thousand updates&lt;/h2&gt;

&lt;p&gt;I don&amp;#39;t know if you noticed, but Microsoft broke Windows Update back in April. I didn&amp;#39;t, at least not until it was October.&lt;/p&gt;

&lt;p&gt;Luckily by then the Internetz had found a solution. Not that it is an easy one, or an elegant one.&lt;/p&gt;

&lt;p&gt;It involves downloading 3 specific MS hotfixes. If you look around the net you will find a different set of hotfixes required, depending on when the posts where written.&lt;/p&gt;

&lt;p&gt;It seems this Windows Update thing broke, got patched, broke again, got patched again and then broke again between April and September, so here is the set of hotfixes that works as of December 2016. It might change in a few months.&lt;/p&gt;

&lt;p&gt;Also, it seems this is not your final solution if you want &lt;a href=&quot;http://www.infoworld.com/article/3099109/microsoft-windows/microsoft-yanks-buggy-speed-up-patch-kb-3161608-replaces-it-with-kb-3172605-and-3172614.html&quot;&gt;working Bluetooth on an Intel chipset&lt;/a&gt;.&lt;/p&gt;

&lt;h2&gt;Windows 7&lt;/h2&gt;

&lt;p&gt;But, it is EOL you will say. It is not available through OEMs you will say. To this I answer: Industry is sluggish, embedded development more so, regulated software development even more so. So we get to enjoy Win7 for a while longer.&lt;/p&gt;

&lt;p&gt;Also, anything after Win7 sucks big time as an embedded software development environment.&lt;/p&gt;

&lt;p&gt;The 100% CPU bug afflicts Win10 as well, but for my scenarios it suffices to use the anniversary edition to work around it.&lt;/p&gt;

&lt;h2&gt;The solution&lt;/h2&gt;

&lt;p&gt;You need &lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://support.microsoft.com/en-us/kb/3020369&quot;&gt;KB3020369&lt;/a&gt;: April 2015 rollup update. So that the convenience rollup update &lt;em&gt;can&lt;/em&gt; install.&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://support.microsoft.com/en-us/kb/3125574&quot;&gt;KB3125574&lt;/a&gt;: the April 2016 convenience rollup, which is what MS calls whatever should have been Win7 SP2, but cannot be called a service pack since it came out way after MS said it will not support Win7 anymore.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;and finally&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://support.microsoft.com/en-us/kb/3172605&quot;&gt;KB3172605&lt;/a&gt; which is the actual fix for the &amp;quot;My CPU is pegged to 100% load for days while looking for windows updates&amp;quot; problem.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;After that you can attempt to re-enable Windows Update.&lt;/p&gt;

&lt;h2&gt;Automation Hell&lt;/h2&gt;

&lt;p&gt;I am a proponent of vanila OS installations, &lt;a href=&quot;software/2015/10/17/windows-installations-virtual-machines&quot;&gt;especially for Windows&lt;/a&gt;
and I have regular automated builds to produce fresh Vagrant baseboxes with Packer.&lt;/p&gt;

&lt;p&gt;Getting the procedure described here with Packer involved a lot of trial and error and a lot of time.&lt;/p&gt;

&lt;p&gt;Things I learned:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;You cannot install offline updates with the windows-shell provisioner since it uses WinRM and on Windows7 the update agent (wusa.exe) does not have to correct access rights.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;This meant that the update installers had to be executed locally within the VM. &lt;/p&gt;

&lt;h3&gt;First approach&lt;/h3&gt;

&lt;p&gt;Copy the installer in the VM (using the &lt;a href=&quot;https://www.packer.io/docs/provisioners/file.html&quot;&gt;&amp;#39;file&amp;#39;&lt;/a&gt; provisioner) and use &lt;a href=&quot;https://www.packer.io/docs/provisioners/shell-local.html&quot;&gt;&amp;#39;shell-local&amp;#39;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;To get &amp;#39;shell-local&amp;#39; to work you have to provide the shell executable (as it uses /bin/sh per default)&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-json&quot; data-lang=&quot;json&quot;&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&quot;type&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;shell-local&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&quot;command&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;wusa.exe MyUPDATE.msu /quiet /norestart&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
   &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&quot;execute_command&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;cmd.exe&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/C&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;{\{.Command\}}&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Unfortunately .msu installers can exit with a variety of non-zero exit codes, 3010 being the one that indicates a reboot is needed. This messes up things.&lt;/p&gt;

&lt;p&gt;Also, copying the large convenience rollup update with the &amp;#39;file&amp;#39; provisioner failed consistently for some reason (it&amp;#39;s a big 500MB file - the rest all copied over with no issues), resulting in a 0 bytes entry and no error on the packer side. &lt;/p&gt;

&lt;p&gt;So this didn&amp;#39;t work.&lt;/p&gt;

&lt;h3&gt;Second approach&lt;/h3&gt;

&lt;p&gt;It was more like the fifth try to be honest. Lots of dead ends.&lt;/p&gt;

&lt;p&gt;The one that worked:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Download the installer from within the VM.&lt;/li&gt;
&lt;li&gt;Create a schedule task to install it on logon.&lt;/li&gt;
&lt;li&gt;Reboot.&lt;/li&gt;
&lt;li&gt;Go into a loop till the hotfix shows up in the list of installed updates (or you timeout).&lt;/li&gt;
&lt;li&gt;Rinse and repeat.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Kludgy, complicated and slow, but it works reliably.
The script I used to detect the hotfix is &lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-powershell&quot; data-lang=&quot;powershell&quot;&gt;&lt;span class=&quot;c1&quot;&gt;#it looks for HOTFIX_ID (KBxxxxx) in the list of installed hotfixes &lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;#and goes in a loop until it shows up or the counter runs out&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;$id&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$env&lt;/span&gt;:HOTFIX_ID
&lt;span class=&quot;nv&quot;&gt;$max_tries&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=[&lt;/span&gt;Int32]&lt;span class=&quot;nv&quot;&gt;$env&lt;/span&gt;:HOTFIX_DETECT_TRIES
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$max_tries&lt;/span&gt; -eq 0&lt;span class=&quot;o&quot;&gt;){&lt;/span&gt;
  &lt;span class=&quot;nv&quot;&gt;$max_tries&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;90
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$counter&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0
&lt;span class=&quot;k&quot;&gt;while&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$counter&lt;/span&gt; -lt &lt;span class=&quot;nv&quot;&gt;$max_tries&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;get-hotfix -id &lt;span class=&quot;nv&quot;&gt;$id&lt;/span&gt; -EA SilentlyContinue&lt;span class=&quot;o&quot;&gt;){&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$counter&lt;/span&gt;+&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1
    &lt;span class=&quot;nb&quot;&gt;Start-Sleep &lt;/span&gt;5
  &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; 
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$counter&lt;/span&gt; -eq &lt;span class=&quot;nv&quot;&gt;$max_tries&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Timed out waiting for &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$id&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; - tried &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$counter&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; times&quot;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;exit &lt;/span&gt;1
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;and this is how it&amp;#39;s called from Packer:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-json&quot; data-lang=&quot;json&quot;&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&quot;type&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;powershell&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&quot;environment_vars&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;HOTFIX_ID=KB3125574&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;HOTFIX_DETECT_TRIES=240&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&quot;script&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;script/detect-hotfix-install.ps1&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Groundhog Day: Chef&lt;/h2&gt;

&lt;p&gt;Like I said, I like vanila OS installs and deal with VMs and bare metal installations. Also with some old installations that have been working non-stop for years. And since they are not internet facing, nobody really bothered to update them. Well, everyone who tried recently gave up and went home crying.&lt;/p&gt;

&lt;p&gt;So I can&amp;#39;t rely on a recently patched version or a freshly produced basebox all the time.&lt;/p&gt;

&lt;p&gt;Which means I needed to re-implement the above as a Chef recipe:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;n&quot;&gt;msu_installers&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;node&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;fetch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;msu_installers&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,{})&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;unless&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;msu_installers&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;empty?&lt;/span&gt;

  &lt;span class=&quot;n&quot;&gt;reboot&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'Restart Computer'&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;action&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:nothing&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;n&quot;&gt;msu_sequence&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;node&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;fetch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;msu_sequence&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,[])&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;msu_sequence&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;each&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;msu_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;pkg&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;msu_installers&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;msu_name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pkg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;source&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;windev_cache_package&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pkg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;save_as&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;source&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pkg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;source&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;depot&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;node&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'software_depot'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;installer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;join&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;node&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;software_depot&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pkg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'save_as'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;ruby_block&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;installer_exists&quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;block&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
          &lt;span class=&quot;k&quot;&gt;raise&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Installer &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;expand_path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;installer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; not found&quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;unless&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;exist?&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;expand_path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;installer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;action&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:run&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;powershell_script&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Install &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pkg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;code&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;wusa.exe &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pkg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;save_as&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; /quiet /norestart&quot;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;action&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:run&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;not_if&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;get-hotfix -id &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pkg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; -EA SilentlyContinue&quot;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;notifies&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:reboot_now&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'reboot[Restart Computer]'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:immediately&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The JSON with the attributes looks like:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-json&quot; data-lang=&quot;json&quot;&gt;&lt;span class=&quot;s2&quot;&gt;&quot;msu_installers&quot;&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
  &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&quot;KB3020369&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:{&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&quot;source&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;URL&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&quot;save_as&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Windows6.1-KB3020369-x64.msu&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;KB3020369&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&quot;KB3125574&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:{&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&quot;source&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;URL&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&quot;save_as&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;windows6.1-kb3125574-foo.msu&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;KB3125574&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&quot;KB3172605&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:{&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&quot;source&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;URL&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&quot;save_as&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Windows6.1-KB3172605-x64.msu&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;KB3172605&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;msu_sequence&quot;&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;KB3020369&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;KB3125574&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;KB3172605&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;To use this you will need the &lt;a href=&quot;https://supermarket.chef.io/cookbooks/windev#readme&quot;&gt;windev cookbook&lt;/a&gt; and you have to also use the auto_chef recipe to handle reboots (if you use Chef without a Chef Server, like I do).&lt;/p&gt;
</description>
        <pubDate>Wed, 28 Dec 2016 11:22:44 +0100</pubDate>
        <link>http://www.ampelofilosofies.gr/software/2016/12/28/windows-update-hell</link>
        <guid isPermaLink="true">http://www.ampelofilosofies.gr/software/2016/12/28/windows-update-hell</guid>
      </item>
    
      <item>
        <title>Workaround for Jenkins CLI authentication</title>
        <description>&lt;p&gt;Been trying to get Jenkins to do various nifty things automatically and it turns out it is possible, only the new 2.x series has authentication turned on by default and we somehow need to authenticate jenkins-cli to be able to do anything.&lt;/p&gt;

&lt;p&gt;This creates a chicken-or-egg problem, since we need jenkins-cli to create the credentials that will enable jenkins-cli to login in the first place. At least if we use the jenkins cookbook or until Jnekins gets a proper HTTP API for these things.&lt;/p&gt;

&lt;p&gt;And as of some recent version before 2.x jenkins-cli will not allow the use of passwords anymore. Sometimes I think people go out of their way to make automating things difficult.&lt;/p&gt;

&lt;p&gt;I chewed at the problem for several days and lots of different angles. At the moment the easiest solution seems to be to disable security for the duration of the setup. Fortunately with a bit of Nokogiri magic this is not a difficult problem.&lt;/p&gt;

&lt;h2&gt;How to turn off security&lt;/h2&gt;

&lt;p&gt;Find the Jenkins &lt;em&gt;config.xml&lt;/em&gt;, set the value of &lt;code&gt;useSecurity&lt;/code&gt; to false.&lt;/p&gt;

&lt;p&gt;Contrary to &lt;a href=&quot;https://wiki.jenkins-ci.org/display/JENKINS/Disable+security&quot;&gt;the Jenkins wiki&lt;/a&gt; advice, you don&amp;#39;t really have to remove the &lt;code&gt;authorizationStrategy&lt;/code&gt; and &lt;code&gt;securityRealm&lt;/code&gt; elements. Leaving them be actually makes restoring the original state easier.&lt;/p&gt;

&lt;p&gt;You can save the following to a file (let&amp;#39;s say &lt;code&gt;security.rb&lt;/code&gt;) and drop it in the libraries/ directory of your cookbook.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;nb&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;nokogiri&quot;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;jenkins_security&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;jenkins_home&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;jenkins_config_file&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;join&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;jenkins_home&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;config.xml&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;raise&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Could not find the Jenkins configuration file at &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;jenkins_home&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;. The disable_security recipe needs to run *after* the jenkins-master default recipe.&quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;unless&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;exist?&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;jenkins_config_file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;jenkins_config&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Nokogiri&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;XML&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;jenkins_config_file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;security_settings&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;jenkins_config&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;xpath&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;//hudson//useSecurity&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;state&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;when&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:on&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;security_settings&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;first&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;true&quot;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;when&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:off&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;security_settings&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;first&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;false&quot;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;raise&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Only :on and :off are valid state values&quot;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;no&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;jenkins_config_file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;w&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;  &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;jenkins_config&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;to_xml&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;The recipe that uses the above code is&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;n&quot;&gt;chef_gem&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'nokogiri'&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;ruby_block&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'disable_security'&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;block&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;jenkins_security&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:off&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;node&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'jenkins'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;][&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'master'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;][&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'home'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;notifies&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:restart&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'service[jenkins]'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:immediately&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;action&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:run&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;The nice thing about this approach is that once we&amp;#39;re done with Jenkins we can reactivate security (just replace the &lt;code&gt;:off&lt;/code&gt; with &lt;code&gt;:on&lt;/code&gt; in the recipe code) and we&amp;#39;re back to the initial state.&lt;/p&gt;

&lt;h2&gt;Pitfalls&lt;/h2&gt;

&lt;p&gt;You will need to block and wait for Jenkins to boot up before including this. For a way to do this you can check &lt;a href=&quot;https://github.com/Zuehlke/cookbooks-jenkins-simple-app&quot;&gt;cookbooks-jenkins-simple-app&lt;/a&gt;&lt;/p&gt;
</description>
        <pubDate>Mon, 30 May 2016 12:22:44 +0200</pubDate>
        <link>http://www.ampelofilosofies.gr/software/2016/05/30/jenkins-cli-authentication</link>
        <guid isPermaLink="true">http://www.ampelofilosofies.gr/software/2016/05/30/jenkins-cli-authentication</guid>
      </item>
    
      <item>
        <title>Damn you Visual Studio</title>
        <description>&lt;p&gt;&lt;em&gt;I&amp;#39;m not being lazy, the bloody piece of shite is compiling&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;Today was a day of deep learning, which is to say that nothing, but absolutely nothing worked as it was supposed to and it took ages to figure out why.&lt;/p&gt;

&lt;p&gt;As of last Friday my project is maintaining two trunks of a rapidly diverging code base - one for the current generation of hardware designated support and master for whatever is coming next.&lt;/p&gt;

&lt;p&gt;Adapting our CI was as simple as cloning the build job pipeline and telling git to check out a different branch. And that worked for about 2 builds at which point the first gate keeper that checks the integration of device and host PC started failing for the support builds.&lt;/p&gt;

&lt;p&gt;The error came from our host tools, which are written in C# and it provoked a big, loud &amp;quot;WAT?&amp;quot; as per the initial &lt;a href=&quot;http://plasmasturm.org/log/6debug/&quot;&gt;stages of debugging&lt;/a&gt; since it was a &amp;quot;I can&amp;#39;t load type so-and-so in assembly so-and-so&amp;quot; for a type that was definitely nowhere to be found in the sources.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/wat.jpg&quot; alt=&quot;wat?!?&quot;&gt;&lt;/p&gt;

&lt;p&gt;Here I have to diverge and explain that we are exposing part of the C# .NET funtionality over COM for use in Ruby scripts and for that reason in the test stages the system registers a couple of assemblies using regasm.&lt;/p&gt;

&lt;p&gt;Now, the system includes 3 C/C++ compilers, python, tcl, ruby, a whole bunch of DSL generation steps in addition to the msbuild invocations so for convenience and speed the clean step is removing the directory where the build artifacts are saved.&lt;/p&gt;

&lt;p&gt;I am a big fan of out-of-band builds (builds that do not mix sources with artifacts) and the fast, permanent and - up until now - reliable clean function is one of my favorite features.&lt;/p&gt;

&lt;p&gt;Trust msbuild to find a way to work around this. So what happened?&lt;/p&gt;

&lt;h2&gt;Cause&lt;/h2&gt;

&lt;p&gt;The cuplrit is called &lt;strong&gt;IntermediateOutputPath&lt;/strong&gt; and is a setting in Visual Studio project files that tells Visual Studio where to place the object files created by it&amp;#39;s compiler before linking. It&amp;#39;s that obj directory that pops up whenever you press F7.&lt;/p&gt;

&lt;p&gt;There is no way to set this in the project properties as far as I know. You have to edit the .csproj file and add it, which is what we do (like I said &lt;em&gt;out-of-band&lt;/em&gt; builds).&lt;/p&gt;

&lt;p&gt;It seems that under certain circumstances (which I have not been able to recreate yet) Visual Studio takes it upon itself to change the value of this parameter.&lt;/p&gt;

&lt;p&gt;It then sets it to a random temporary directory using ENV[TEMP] as the basis and puts that value in the .csproj file which obviously gets commited.&lt;/p&gt;

&lt;p&gt;And this happened in an indeterminate point in the past before we ever had multiple trunks.&lt;/p&gt;

&lt;h2&gt;Effect&lt;/h2&gt;

&lt;p&gt;Switch now to the main build server who in the alleged security of out-of-band builds attempts to build both trunks.&lt;/p&gt;

&lt;p&gt;Given a team that commits rapidly on the master branch clearing technical debt and sparingly on the support branch, you will very quickly reach the point where the sources on the support branch are by definition older than the corresponding object files in said &amp;quot;temporary&amp;quot; directory.&lt;/p&gt;

&lt;p&gt;But msbuild doesn&amp;#39;t know that. It sees newer object files and hapilly goes &amp;quot;I don&amp;#39;t have to build this, hihi&amp;quot; and links some random piece of code for you. And since you&amp;#39;re an idiot and forgot to de-register the assembly before building any type mismatches are not reported by the linker. Hilarity ensues.&lt;/p&gt;

&lt;h2&gt;Lessons learned&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;This is a fine example of the evils of shared state.&lt;/li&gt;
&lt;li&gt;Not one tool vendor has really thought about building things in parallel.&lt;/li&gt;
&lt;li&gt;Always do clean builds on your CI.

&lt;ul&gt;
&lt;li&gt;Containers are nice, but...Windows.&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;Never assume the tool knows better and never assume you cleaned up everything.&lt;/li&gt;
&lt;li&gt;Visual Studio is evil.&lt;/li&gt;
&lt;li&gt;There is always something you missed. Have multiple levels of testing.&lt;/li&gt;
&lt;/ul&gt;
</description>
        <pubDate>Tue, 16 Feb 2016 14:02:44 +0100</pubDate>
        <link>http://www.ampelofilosofies.gr/software/2016/02/16/damn-you-vs</link>
        <guid isPermaLink="true">http://www.ampelofilosofies.gr/software/2016/02/16/damn-you-vs</guid>
      </item>
    
      <item>
        <title>Windows Installations & Virtual Machines</title>
        <description>&lt;p&gt;&lt;em&gt;This post was originally written in July 2014 and then lounged in the dusty, dark recesses of my disk because... Windows. The hindsight of a whole year of using the Packer/Vagrant/Chef workflow led to minor updates, which speaks for the applicability of the approach&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;Automating Windows installations is hard!&lt;/p&gt;

&lt;p&gt;Maybe hard is not the right word. &amp;#39;Unecessarily complicated&amp;#39;, &amp;#39;obfuscated&amp;#39;, &amp;#39;frustrating&amp;#39; come to mind&lt;sup&gt;1&lt;/sup&gt;. Sometimes, for certain, not so stelarly engineered solutions the word &amp;#39;impossible&amp;#39; creeps around the corner.&lt;/p&gt;

&lt;p&gt;And yet things have never been better for anyone trying to solve the riddle. All the tools are there and while looking at the *ix solutions you wish for a lot of things (like a decent shell, or no registry, or a standardized way for installer parameters, or a package repository or...you get my drift) &amp;#39;impossible&amp;#39; has had to hide in some really obscure corners.&lt;/p&gt;

&lt;h2&gt;Installation drudgery&lt;/h2&gt;

&lt;p&gt;I can&amp;#39;t even begin to estimate the times I have installed Windows from scratch. It became tedious very, very fast but there was no release in sight for a long time.&lt;/p&gt;

&lt;p&gt;With the advent of desktop virtualization and laptops that can accomodate a couple of Windows VMs running concurrently I follow the practice of keeping one pristine Windows installation&lt;sup&gt;2&lt;/sup&gt; at hand and a bootstrap package of command files that install the latest &lt;a href=&quot;http://chefdk.com&quot;&gt;ChefDK&lt;/a&gt;, an SVN client and git for Windows.&lt;/p&gt;

&lt;p&gt;The workflow as it stands:&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;Copy the VM&lt;/li&gt;
&lt;li&gt;Boot the VM and perform any outstanding updates (this includes Windows and the virtualization tools &amp;amp; drivers)&lt;/li&gt;
&lt;li&gt;Copy the bootstrap package over and run the command file&lt;/li&gt;
&lt;li&gt;Checkout/clone the repository with all my Windows recipes&lt;/li&gt;
&lt;li&gt;Run Chef to provision the VM&lt;/li&gt;
&lt;/ol&gt;

&lt;h2&gt;Not enough (?)&lt;/h2&gt;

&lt;p&gt;VMs are bulky. With a dynamically growing disk a vanilla Windows VM ways in at about 20GB. Add to that the software for toolchains etc. and it grows very large indeed (my current C/C++ embedded environment weights in at 50GB).&lt;/p&gt;

&lt;p&gt;You can&amp;#39;t expect everyone to download it every time it changes so the case for immutable infrastructure when creating development environments is not very strong. Also, developers tend to have a lot of half-finished and ongoing work on disk which means you can&amp;#39;t really throw away the VM when updating, you have to do an incremental update for user friendliness sake.&lt;/p&gt;

&lt;p&gt;A properly configured Windows base box is smaller (about 5GB) and we can skip the time it takes to create it from an .iso, because, well, we don&amp;#39;t do it very often.&lt;/p&gt;

&lt;p&gt;Create the base box using &lt;a href=&quot;http://www.packer.io&quot;&gt;Packer&lt;/a&gt;, add a Vagrantfile to the repository and host the base box in a known location and we have the capability to recreate the development environment.&lt;/p&gt;

&lt;p&gt;How much goes into the base box in terms of software and configuration is your choice but vanilla installations work best, especially with Windows (you get the benefit of having a pristine registry database).&lt;/p&gt;

&lt;p&gt;Keep in mind that you have to update the base box regularly to avoid the massive Windows Update penalty when creating new VM instances. Automating the creation process with Packer is thankfully very easy and can be delegated to a CI/cron job.&lt;/p&gt;

&lt;p&gt;Everything else is done with Chef and a bit of powershell (to bootstrap Chef from Vagrant). To help with that we have a cookbook by the name of &lt;a href=&quot;https://github.com/Zuehlke/cookbook-windev&quot;&gt;windev&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;So the workflow becomes&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;vagrant up&lt;/li&gt;
&lt;li&gt;Run Chef to provision the VM&lt;/li&gt;
&lt;li&gt;Go back to 2. when necessary&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;We still haven&amp;#39;t solved the performance problem. It takes a long time to start a VM and the traditional desktop hypervisors hog a lot of resources. Docker is not a viable solution because Windows, so we have a case of serious OS envy.&lt;/p&gt;

&lt;hr&gt;

&lt;p&gt;&lt;sup&gt;1&lt;/sup&gt; After years of deliberation I am convinced that the Windows Registry is among the top 5 of  engineering solutions that on hindsight revealed themselves as colossal PITA mistakes. It may even occupy the top spot, but then, I&amp;#39;m biased.&lt;/p&gt;

&lt;p&gt;&lt;sup&gt;2&lt;/sup&gt; Meaning just a vanilla installation with no additional software other than the latest Microsoft patches.&lt;/p&gt;
</description>
        <pubDate>Sat, 17 Oct 2015 14:02:44 +0200</pubDate>
        <link>http://www.ampelofilosofies.gr/software/2015/10/17/windows-installations-virtual-machines</link>
        <guid isPermaLink="true">http://www.ampelofilosofies.gr/software/2015/10/17/windows-installations-virtual-machines</guid>
      </item>
    
      <item>
        <title>Cars: To drive or not to drive?</title>
        <description>&lt;p&gt;I don&amp;#39;t own a car and on the rare occasions I need one, I rent. So I get to drive lots of different cars and most of them brand new. In my daily slog I don&amp;#39;t use a car, it&amp;#39;s trains, trains, trains. Wouldn&amp;#39;t use a car even if I owned one. Which in hindsight is probably why I enjoy driving so much.&lt;/p&gt;

&lt;p&gt;This summer I got to drive a lot in Greece and the UK. All the rentals came equiped with cruise control (for the curious: a Pegeuot 307, a Honda Jazz and a Ford Kuga) and initially the novelty of the feature was a fun game. Then I drove on the M62 in England and was glad for it because it made obeying the draconian speed limits simpler and easier. &lt;/p&gt;

&lt;p&gt;The empty expanse of a three lane motorway stretched infront of me and begged me to drop my foot on the gas pedal like a lead weight. Cruise control kept me in check. And then I got bored. Driving isn&amp;#39;t really fun on the motorway.&lt;/p&gt;

&lt;p&gt;I enjoy complex things and driving is one of the most complex activities we undertake: In a manual transmission car it requires the coordinated but independent actions of all four limbs while processing audio and visual sensory input and all of this moving at high speeds in a chaotic system. &lt;/p&gt;

&lt;p&gt;An automatic transmission takes the left foot out of the equation, cruise control does the same for the right (for certain motorway stretches - don&amp;#39;t ever use cruise control on the mountains of Greece, it won&amp;#39;t turn out OK). &lt;/p&gt;

&lt;p&gt;It&amp;#39;s an approximation of how it will feel in a self-driving car. Only it&amp;#39;s not, because you &amp;#39;re still on constant alert, actively scanning with peripheral vision, judging the relative speeds of cars in front, steering etc. All I can say is, bring me the self-driving car, I don&amp;#39;t like this stressful in-between state.&lt;/p&gt;

&lt;p&gt;I am all for self-driving cars, even considering the &lt;a href=&quot;https://medium.com/basic-income/self-driving-trucks-are-going-to-hit-us-like-a-human-driven-truck-b8507d9c5961&quot;&gt;downsides&lt;/a&gt;. The benefits are overwhelming.&lt;/p&gt;

&lt;p&gt;Imagine an electric self-driving car: It needs no transmission, no pedals, no steering wheel. It can be symmetric, doesn&amp;#39;t need to have a designated front or back. It&amp;#39;s going to be lighter and roomier, will move faster through roads with no traffic jams, consume less energy and have better active/passive safety than anything with a slightly sleepy, distracted driver.&lt;/p&gt;

&lt;p&gt;Driving should be consigned to a hobby, much like riding horses is. Riding horses is unarguably the more useful skill to have in a post-apocalyptic society but I find the complexity of driving appealing.&lt;/p&gt;
</description>
        <pubDate>Sun, 30 Aug 2015 14:00:00 +0200</pubDate>
        <link>http://www.ampelofilosofies.gr/rumblings/2015/08/30/cars-to-drive-or-not-to-drive</link>
        <guid isPermaLink="true">http://www.ampelofilosofies.gr/rumblings/2015/08/30/cars-to-drive-or-not-to-drive</guid>
      </item>
    
      <item>
        <title>ForgetMeNot: Turn off Windows Compatibility Appraiser</title>
        <description>&lt;p&gt;One of the advantages of infrastructure as code is that we now have complete control of the states of a computer.&lt;/p&gt;

&lt;p&gt;This consequently means that I can measure performance between two known states and I only have to look at the difference between states to figure out what went wrong.&lt;/p&gt;

&lt;p&gt;Well, in theory. Microsoft and the Microsoft Updates keep pulling the carpet under your feet. &lt;/p&gt;

&lt;p&gt;In this case, one of the patch Tuesdays in February introduced KB 2952664 which adds the &amp;quot;Microsoft Compatibility Appraiser&amp;quot; to ostensibly ease transition to Windows 10. Unfortunately that drives up CPU usage and brings computers (and much worse, VMs) to their knees. &lt;/p&gt;

&lt;p&gt;The whole process is a collection of tasks running regularly, whether a user is logged on or not and more importantly whether you opt-in for the MS customer experience program or not.&lt;/p&gt;

&lt;p&gt;It&amp;#39;s all &lt;a href=&quot;http://www.infoworld.com/article/2911609/operating-systems/kb-2952664-compatibility-update-for-win7-triggers-unexpected-daily-telemetry-run-may-be-snooping.html&quot;&gt;very fishy&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Turns out VMWare has a &lt;a href=&quot;https://pubs.vmware.com/view-51/index.jsp?topic=%2Fcom.vmware.view.administration.doc%2FGUID-BE82165B-13BC-4FD9-A9CF-FBEF6343D98A.html&quot;&gt;knowledge base article&lt;/a&gt; for the tasks that need to be excised.&lt;/p&gt;

&lt;p&gt;The following commandlines solve (or at least appear to solve) the problem:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-&quot; data-lang=&quot;&quot;&gt;schtasks /Delete /F /TN &quot;\Microsoft\Windows\Application Experience\AitAgent&quot;
schtasks /Delete /F /TN &quot;\Microsoft\Windows\Application Experience\Microsoft Compatibility Appraiser &quot;
schtasks /Delete /F /TN &quot;\Microsoft\Windows\Application Experience\ProgramDataUpdater&quot;
schtasks /Delete /F /TN &quot;\Microsoft\Windows\Customer Experience Improvement Program\Consolidator&quot;
schtasks /Delete /F /TN &quot;\Microsoft\Windows\Customer Experience Improvement Program\KernelCEIPTask&quot;
schtasks /Delete /F /TN &quot;\Microsoft\Windows\Customer Experience Improvement Program\Use CEIP&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;These will go into a new &lt;a href=&quot;https://github.com/Zuehlke/cookbook-windev&quot;&gt;windev&lt;/a&gt; recipe for sure.&lt;/p&gt;
</description>
        <pubDate>Fri, 10 Jul 2015 14:00:00 +0200</pubDate>
        <link>http://www.ampelofilosofies.gr/software/2015/07/10/forgetmenot-turn-off-windows-compatibility-appraiser</link>
        <guid isPermaLink="true">http://www.ampelofilosofies.gr/software/2015/07/10/forgetmenot-turn-off-windows-compatibility-appraiser</guid>
      </item>
    
      <item>
        <title>  </title>
        <description>&lt;p&gt;   ,            ;&lt;/p&gt;

&lt;p&gt;    &amp;quot;     &amp;quot;        .&lt;/p&gt;

&lt;p&gt;     .         .    ,             (        )        ,       5       :&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;        ,  ,   .&lt;/li&gt;
&lt;li&gt;    ,          .&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;,       .    &amp;quot;   ,   ,     ,  ,     &amp;quot;,  &amp;quot;         &amp;quot;.      indentured service,           .&lt;/p&gt;

&lt;p&gt;              (     ,        )          ,       .   ;                  ;                   ;       ,    ,      .&lt;/p&gt;

&lt;p&gt;                  .        ,          .           ,         .               &lt;sup&gt;1&lt;/sup&gt;.      6          .&lt;/p&gt;

&lt;p&gt;,    :&lt;/p&gt;

&lt;p&gt;    ,     ,           ,                   .&lt;/p&gt;

&lt;p&gt;  ,    (   )                (          )     .&lt;/p&gt;

&lt;p&gt;;&lt;/p&gt;

&lt;p&gt;    ,    ,   ,      ,            .                                ,     ,       .&lt;/p&gt;

&lt;p&gt;, ,   ,            ,       &amp;#39;50,                 .&lt;/p&gt;

&lt;p&gt;  ,   ,  ,   ,   . ,   ,    .&lt;/p&gt;

&lt;p&gt;!      (      )   .   ,      ,  .        :  ,  ,        .   11     ;&lt;/p&gt;

&lt;p&gt;        ,      ... .   ,   ,        .   .         . .   .       .&lt;/p&gt;

&lt;p&gt;    ,      .&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;     ,      , ,   (, ,   )&lt;/li&gt;
&lt;li&gt;            .  ,        ( &amp;#39; ,   )&lt;/li&gt;
&lt;li&gt;     ,             .    , . (             ).&lt;/li&gt;
&lt;li&gt;    (,  )&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;          .&lt;/p&gt;

&lt;p&gt;&amp;quot;  &amp;#39;   &amp;quot;   Juncker,   ,           . &lt;/p&gt;

&lt;p&gt;                  .       ,   ,          ,        ,          ,        .       ,          .&lt;/p&gt;

&lt;hr&gt;

&lt;p&gt;&lt;sup&gt;1&lt;/sup&gt;  !   &lt;em&gt;&lt;/em&gt; ! 11         ; , , ,  ,    , .&lt;/p&gt;
</description>
        <pubDate>Wed, 01 Jul 2015 14:00:00 +0200</pubDate>
        <link>http://www.ampelofilosofies.gr/rumblings/2015/07/01/theater-of-the-absurd</link>
        <guid isPermaLink="true">http://www.ampelofilosofies.gr/rumblings/2015/07/01/theater-of-the-absurd</guid>
      </item>
    
      <item>
        <title>ForgetMeNot: SublimeText shell with errors on Windows</title>
        <description>&lt;p&gt;I&amp;#39;ve been running &lt;a href=&quot;http://www.sublimetext.com/3&quot;&gt;SublimeText v3&lt;/a&gt; with the &lt;a href=&quot;https://github.com/misfo/Shell-Turtlestein&quot;&gt;Shell-Turtlestein&lt;/a&gt; plugin for a while now.&lt;/p&gt;

&lt;p&gt;There&amp;#39;s rarely a need to switch out of the editor window anymore and I&amp;#39;m feeling more emacsy than ever.&lt;/p&gt;

&lt;p&gt;I use the same setup on all platforms (Windows, OS X and Linux) and all it takes to configure is a couple or JSON files in the correct locations.&lt;/p&gt;

&lt;p&gt;Shell-Turtlestein uses the same technique that the SublimeText build systems use to parse errors from the output of a command and this involves regular expressions (que moan). &lt;/p&gt;

&lt;p&gt;I also mostly run rake and drive minitest unit tests so there is a couple of cases where I would like to jump to the line an error indicates:
When a test assertion fails and when an exception occurs.&lt;/p&gt;

&lt;p&gt;The following entry in the Shell-Turtlestein settings file will allow the use of F4 to jump to the error line in these two cases on windows (for *ix OSes there&amp;#39;s plenty of examples out there)&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-json&quot; data-lang=&quot;json&quot;&gt;&lt;span class=&quot;s2&quot;&gt;&quot;exec_args&quot;&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&quot;file_regex&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;^\\s*\\w*\\(*\\w*\\)*\\s*\\[*(\\w+:\\/.+\\.*\\w*):([0-9]+)\\]*:()(.*)&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;
</description>
        <pubDate>Wed, 30 Jul 2014 00:00:00 +0200</pubDate>
        <link>http://www.ampelofilosofies.gr/software/2014/07/30/forgetmenot-sublimetext-shell-with-errors-on-windows</link>
        <guid isPermaLink="true">http://www.ampelofilosofies.gr/software/2014/07/30/forgetmenot-sublimetext-shell-with-errors-on-windows</guid>
      </item>
    
      <item>
        <title>VAR's Build Rules</title>
        <description>&lt;p&gt;This is a post that came out of a discussion thread at work &lt;sup&gt;1&lt;/sup&gt;. Originally it was a simple question on alternatives to TFS as a build system. But you know how it goes, things evolve into questions you can only answer with 42.&lt;/p&gt;

&lt;p&gt;During the conversation the rules described in this post came out of the woodwork.&lt;/p&gt;

&lt;h2&gt;Distinctions, distinctions&lt;/h2&gt;

&lt;p&gt;Before we get into the rules we need to distinguish between a build system and a build management system.&lt;/p&gt;

&lt;p&gt;A build system performs transformations in sequence according to a predetermined dependency chain to create artifacts. A subset of this is the compilation of sources to binaries.&lt;/p&gt;

&lt;p&gt;A build management system coordinates build system(s).&lt;/p&gt;

&lt;p&gt;A build system is highly project specific, it is affected by toolchains, project conventions and generally can only run on a specially configured host (i.e. development environment).&lt;/p&gt;

&lt;p&gt;A build management system can run everywhere so long as it can start the build system on the appropriate host. The specificity of a build management system is limited to the number of version control systems it supports. Although theoretically it doesn&amp;#39;t have to provide version control support it is a given that such support will be provided in the minimum feature set.&lt;/p&gt;

&lt;p&gt;Jenkins, TeamCity, TravisCI, BuildBot are build management systems.&lt;/p&gt;

&lt;p&gt;TFS tries to do both at once, mixes them up, confuses the terminology and generally does a bang up job of completely screwing things up.&lt;/p&gt;

&lt;h2&gt;VAR&amp;#39;s Build Rules&lt;/h2&gt;

&lt;p&gt;(var is my username at work)&lt;/p&gt;

&lt;h3&gt;1. I am the build server&lt;/h3&gt;

&lt;p&gt;Rule #1 requires that the build server follows the exact same steps as any other developer. &lt;/p&gt;

&lt;p&gt;Expressed the other way around: Every developer has to be able to recreate locally the complete build process without deviations given the development environment and the correct version of the source tree.&lt;/p&gt;

&lt;h3&gt;2. When the build server says no, it means no!&lt;/h3&gt;

&lt;p&gt;Rule #2 says that if a build server says a build is broken, then the build is broken. Drop everything and read the logs. &lt;/p&gt;

&lt;p&gt;There is no &amp;quot;it works for me&amp;quot;, your build server is Judge Dredd: judge, juror and executioner.&lt;/p&gt;

&lt;p&gt;You can only adhere to this rule if you followed Rule #1&lt;/p&gt;

&lt;h3&gt;3. IDEs are the enemy AKA F5 is not a build process&lt;/h3&gt;

&lt;p&gt;Which means that if you drive your development process from an IDE there is no way you can adhere to the Build Rules. &lt;/p&gt;

&lt;p&gt;This rule has major complications on the development environment, ties directly into the subject of allowing your developers to use whatever tools they feel comfortable with and adherence to it is actively sabotaged by Visual Studio.&lt;/p&gt;

&lt;p&gt;My current approach to this problem is laid out in &lt;a href=&quot;/software/2014/07/03/gaudi-versus-the-dreaded-ide&quot;&gt;Gaudi vs. the dreaded IDE&lt;/a&gt;&lt;/p&gt;

&lt;h2&gt;Adhering to the rules&lt;/h2&gt;

&lt;p&gt;To create a system that adheres to rules #1 &amp;amp; #2 you have to think like a Lego builder: Lots of small, specialized tasks that do one thing can be used to compose more complex processes etc.&lt;/p&gt;

&lt;p&gt;As an example a &lt;em&gt;release&lt;/em&gt; task instead of doing everything in one big implementation will depend on the build tasks for each of the libraries and applications and the tasks that run the tests etc. Using the syntax of rake in a contrived example one would do&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;n&quot;&gt;task&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:release&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:&quot;test:all&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;task&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:&quot;test:all&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:&quot;test:foo&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:&quot;test:bar&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;task&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:&quot;test:foo&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:&quot;build:foo&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now a developer will probably use the component tasks a lot more than the composite :release task and we will certainly have a build job on the server that only does releases.&lt;/p&gt;

&lt;p&gt;This is a necessity since the system needs to satisfy different usage  patterns: the build server uses composite tasks that implement complete workflows while the developer usex component tasks with surgical precision in the interest of speed and effectiveness.&lt;/p&gt;

&lt;p&gt;From the perspective of the build system engineer this approach is self-evident for the same reason it&amp;#39;s evident when building applications: Small chunks of code are easier to manage, test, reuse and understand.&lt;/p&gt;

&lt;p&gt;It&amp;#39;s also one of the reasons why make, ant and the msbuild XML syntax suck big time as general task description languages but that is a subject that requires a whole other post.&lt;/p&gt;

&lt;p&gt;All of this segways nicely into the final rule:&lt;/p&gt;

&lt;h3&gt;4. Your (build) infrastructure is a software development project&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;/software/2011/02/04/managing-your-development-environment&quot;&gt;This post has already been written&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Rule #4 means you need tests and CI and a plan. To make matters worse your users are some of the most obnoxious, impatient and down right pedantic users on the face of the planet. They want everything perfect, robust, simple and fast and they want it yesterday. You better be dogfooding by this point...&lt;/p&gt;

&lt;hr&gt;

&lt;p&gt;&lt;sup&gt;1&lt;/sup&gt; I work at &lt;a href=&quot;http://www.zuehlke.com&quot;&gt;Zhlke&lt;/a&gt; where I have the luck to interact with brilliant engineers. Not just software engineers either.&lt;/p&gt;
</description>
        <pubDate>Thu, 17 Jul 2014 16:00:00 +0200</pubDate>
        <link>http://www.ampelofilosofies.gr/software/2014/07/17/vars-build-rules</link>
        <guid isPermaLink="true">http://www.ampelofilosofies.gr/software/2014/07/17/vars-build-rules</guid>
      </item>
    
      <item>
        <title>Gaudi versus the dreaded IDE</title>
        <description>&lt;p&gt;I will come out and say it: I dislike IDEs. From Visual Studio to Eclipse by way of IntelliJ and Netbeans I find them all slow, unwieldy, complicated and buggy. They hide too much of the workings of the toolchains, spread configruation over a zillion dialogs, collaborate with source control like a stray dog with an alley cat and litter the workspace with all kinds of useless files.&lt;/p&gt;

&lt;p&gt;Way back in `07 Jeff Atwood penned &amp;quot;&lt;a href=&quot;http://blog.codinghorror.com/the-f5-key-is-not-a-build-process/&quot;&gt;The F5 Key Is Not A Build Process&lt;/a&gt;&amp;quot;. While I could add about 4 pages of things you can do with a &amp;quot;build script&amp;quot; outside of an IDE it wouldn&amp;#39;t add anything to the point so go read it. &lt;/p&gt;

&lt;p&gt;Then go print &amp;quot;The F5 Key Is Not A Build Process&amp;quot; on a banner, hung it in the office and live by it.&lt;/p&gt;

&lt;h2&gt;But...&lt;/h2&gt;

&lt;p&gt;There is one and only one unavoidable reason to use a fully fledged IDE and that is &lt;em&gt;The Debugger&lt;/em&gt;! 
Every other reason can be done away with, provided there is sufficient editor and shell foo.&lt;/p&gt;

&lt;p&gt;But IDE projects have big disadvantages when following proper software development practices (e.g. at least continuous integration with automated tests). Generally if you want to develop in an IDE and have a CI system you end up maintaining both separately&lt;sup&gt;1&lt;/sup&gt;. &lt;/p&gt;

&lt;p&gt;We define as maintenance the tasks of adding/removing files, defining dependencies between code components, compiler settings etc.&lt;/p&gt;

&lt;p&gt;Errors in the IDE projects are also very hard to detect automatically: The build server will not use the IDE so the  change is going to propagate to the whole team. There is nothing that drives developers to frustration faster than not being able to compile locally when the build server says everything is fine.&lt;/p&gt;

&lt;p&gt;Solution: make the command line build system the master and provide IDE project generation facilities. &lt;/p&gt;

&lt;p&gt;When a developer wants to use the IDE, she generates the project from a freshly updated workspace with the correct settings and continues working.&lt;/p&gt;

&lt;p&gt;&amp;quot;But, there&amp;#39;s so many IDEs out there and they all use different file formats!&amp;quot; you will say and you will be absolutely correct. &lt;/p&gt;

&lt;p&gt;The best case is when the IDE allows you to use a custom build system. This removes Visual Studio and a couple of more obscure ones from the list of frendlies, but VS has a very good documented XML-based format so there are ways around it.&lt;/p&gt;

&lt;p&gt;Still the following example can be adapted to work in every case.&lt;/p&gt;

&lt;h2&gt;Gaudi &amp;amp; QtCreator Example&lt;/h2&gt;

&lt;p&gt;Let&amp;#39;s say we have a project that uses &lt;a href=&quot;http://github.com/damphyr/gaudi&quot;&gt;Gaudi&lt;/a&gt; as it&amp;#39;s build system. And let&amp;#39;s say the team insisted on using &lt;a href=&quot;https://qt-project.org/doc/qtcreator-2.5/index.html&quot;&gt;QtCreator&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;QCreator uses two separate files: One file (prj.pro) lists the files, resources, paths etc. while the other (prj.user.pro) contains the IDE settings (layout, colors and more importantly the build &amp;amp; run settings). &lt;/p&gt;

&lt;p&gt;Instead of maintaining the QtCreator project files separately we create a template from a functioning project file. In other words use the GUI once to configure everthing just so. &lt;/p&gt;

&lt;p&gt;For convenience we use the ERB format for the templates&lt;sup&gt;2&lt;/sup&gt;&lt;/p&gt;

&lt;p&gt;The prj.pro.template is very simple:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-html&quot; data-lang=&quot;html&quot;&gt;TEMPLATE = app
CONFIG += console
CONFIG -= app_bundle
CONFIG -= qt

SOURCES += \
    &lt;span class=&quot;err&quot;&gt;&amp;lt;&lt;/span&gt;%=source_list.join(&quot; \\\n    &quot;)%&amp;gt;

HEADERS += \
    &lt;span class=&quot;err&quot;&gt;&amp;lt;&lt;/span&gt;%=header_list.join(&quot; \\\n    &quot;)%&amp;gt;

OTHER_FILES += \
    &lt;span class=&quot;err&quot;&gt;&amp;lt;&lt;/span&gt;%=other_list.join(&quot; \\\n    &quot;)%&amp;gt;

INCLUDEPATH += \
    &lt;span class=&quot;err&quot;&gt;&amp;lt;&lt;/span&gt;%=include_path_list.join(&quot; \\\n    &quot;)%&amp;gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Here we show only the relevant part from the prj.user.pro.template&lt;sup&gt;3&lt;/sup&gt; with the custom build system settings&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-xml&quot; data-lang=&quot;xml&quot;&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;valuemap&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;QVariantMap&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;key=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;....Target.BuildConfiguration.0&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;value&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;QString&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;key=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;....BuildDirectory&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;&amp;lt;&lt;/span&gt;%=build_directory%&amp;gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;/value&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;valuemap&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;QVariantMap&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;key=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;ProjectExplorer.BuildConfiguration.BuildStepList.0&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;valuemap&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;QVariantMap&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;key=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;ProjectExplorer.BuildStepList.Step.0&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;value&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;bool&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;key=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;ProjectExplorer.BuildStep.Enabled&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;true&lt;span class=&quot;nt&quot;&gt;&amp;lt;/value&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;value&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;QString&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;key=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;...Arguments&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;GAUDI_CONFIG=&lt;span class=&quot;err&quot;&gt;&amp;lt;&lt;/span&gt;%=system_config_file%&amp;gt; 
  build:deployment DEPLOYMENT=&lt;span class=&quot;err&quot;&gt;&amp;lt;&lt;/span&gt;%=deployment_name%&amp;gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;/value&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;value&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;QString&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;key=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;...Command&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;rake&lt;span class=&quot;nt&quot;&gt;&amp;lt;/value&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;value&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;QString&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;key=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;...WorkingDirectory&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;&amp;lt;&lt;/span&gt;%=base%&amp;gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;/value&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;value&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;QString&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;key=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;...DefaultDisplayName&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;Rake Build&lt;span class=&quot;nt&quot;&gt;&amp;lt;/value&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;value&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;QString&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;key=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;...DisplayName&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;/value&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;value&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;type=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;QString&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;key=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;...Id&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;ProjectExplorer.ProcessStep&lt;span class=&quot;nt&quot;&gt;&amp;lt;/value&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/valuemap&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;We now have our templates. The parameter names are fully arbitrary at the moment, they serve only as descriptive names.&lt;/p&gt;

&lt;p&gt;We are faced with the task of collecting the file names, setting paths correctly etc. This is where &lt;a href=&quot;http://github.com/damphyr/gaudi&quot;&gt;Gaudi&lt;/a&gt; comes in.
The Rake task code that generates the prj.pro file looks like the following:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;n&quot;&gt;task&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:qtc&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;#Quick and dirty get the first GCC program available to get the example running&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;program&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Gaudi&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Deployment&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Dummy&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;programs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;gcc&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;#Use the configuration methods to place artifacts within the workspace&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;outfile&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;join&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;vg&quot;&gt;$configuration&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;out&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;qtcreator&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;program&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;program&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;.pro&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;template&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;join&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;vg&quot;&gt;$configuration&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;base&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'tools/templates/qtcreator.pro.template'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;#collect all source and header files&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;source_list&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;program&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;sources&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;header_list&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;program&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;headers&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;#A Gaudi::Program depends on Gaudi::Components &lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;#which are groupings of source files.&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;#This gets us all sources and headers&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;program&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;dependencies&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;each&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dep&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;source_list&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dep&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;sources&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;header_list&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dep&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;headers&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;#one of the ways to get the include paths&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;include_path_list&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;header_list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;map&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;header&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;dirname&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;header&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;uniq&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;#The Hash with the template parameters&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;params&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;source_list&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;source_list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;uniq&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;s2&quot;&gt;&quot;header_list&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;header_list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;uniq&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;s2&quot;&gt;&quot;include_path_list&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;include_path_list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;s2&quot;&gt;&quot;other_list&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;program&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;configuration&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;config_file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;uniq&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;write_file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;outfile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;from_template&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;template&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;params&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;What we get from Gaudi:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;The configuration defining the workspace (output directory, base directory etc.)&lt;/li&gt;
&lt;li&gt;A few classes (Deployment, Program, Component) linking sources to binary artifacts and encapsulating the dependencies between code constructs&lt;/li&gt;
&lt;li&gt;Helpers for template handling (from&lt;em&gt;template, write&lt;/em&gt;file etc.)&lt;/li&gt;
&lt;/ul&gt;

&lt;h2&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;Creating IDE project files while maintaining a fully command line enabled build system is not very difficult. The combination of one of the myriad template engines with a few lines of scripting to collect the necessary information gets you quickly to a very usable solution. The bulk of the time spent is dedicated to deciphering the IDE file format and creating the template.&lt;/p&gt;

&lt;h2&gt;You never walk alone&lt;/h2&gt;

&lt;p&gt;QtCreator expertise provided and code polished by &lt;a href=&quot;http://github.com/jahnf&quot;&gt;jahnf&lt;/a&gt; who suffered through all my explanations of Gaudi interna and managed to write tasks at the end.&lt;/p&gt;

&lt;hr&gt;

&lt;p&gt;&lt;sup&gt;1&lt;/sup&gt; It can be done but driving the process of development from the IDE throws up all sorts of hurdles in a proper CI workflow.&lt;/p&gt;

&lt;p&gt;&lt;sup&gt;2&lt;/sup&gt; Gaudi is built on Rake, which is Ruby, which offers ERB in the standard library&lt;/p&gt;

&lt;p&gt;&lt;sup&gt;3&lt;/sup&gt; Because XML! &lt;/p&gt;

&lt;p&gt;&lt;sup&gt;4&lt;/sup&gt; Once set up and configured properly&lt;/p&gt;
</description>
        <pubDate>Thu, 03 Jul 2014 16:00:00 +0200</pubDate>
        <link>http://www.ampelofilosofies.gr/software/2014/07/03/gaudi-versus-the-dreaded-ide</link>
        <guid isPermaLink="true">http://www.ampelofilosofies.gr/software/2014/07/03/gaudi-versus-the-dreaded-ide</guid>
      </item>
    
  </channel>
</rss>